# Bybit API (храни в .env, не коммить ключи)
BYBIT_API_KEY=
BYBIT_API_SECRET=

# Testnet: true = тестовая сеть, false = боевая
BYBIT_TESTNET=true

# Торговый режим: linear (USDT-M), inverse, spot
BYBIT_CATEGORY=linear

# Пара для торговли
SYMBOL=BTCUSDT

# Таймфреймы через запятую (минуты: 1,3,5,15,30,60,120,240,360,720 или D,W,M)
TIMEFRAMES=15,60,240
# Глубина стакана (bid/ask) для чтения в реальном времени; linear: 1–500
ORDERBOOK_LIMIT=25
# Order Flow (DOM, T&S, Delta, Sweeps): 1 = запускать стакан и поток сделок, результат в отчёте; 0 = выкл
ORDERFLOW_ENABLED=1
# Окно для T&S и Volume Delta (секунды)
ORDERFLOW_WINDOW_SEC=60
# WebSocket Bybit: ping_interval должен быть > ping_timeout (иначе «Ensure ping_interval > ping_timeout»)
ORDERFLOW_WS_PING_INTERVAL=30
ORDERFLOW_WS_PING_TIMEOUT=20
# 1 = писать метрики Order Flow в таблицу orderflow_metrics (та же БД); 0 = не писать
ORDERFLOW_SAVE_TO_DB=1
# 1 = песочница микроструктуры: виртуальная позиция и PnL по сигналу (нужен ORDERFLOW_ENABLED=1); 0 = выкл
MICROSTRUCTURE_SANDBOX_ENABLED=1
# Стартовый виртуальный баланс в USD для песочницы (например 100)
SANDBOX_INITIAL_BALANCE=100

# Минимальный score фазы (0..1). Подбор: python bin/backtest_phases.py --sweep-min-score / --tune. Рекомендуется 0.65–0.7 для лучшей точности по направлению.
PHASE_SCORE_MIN=0.65
# Ниже этого score фаза считается неясной (phase_unclear). Минимальный разрыв между основной и второй фазой (score_gap).
PHASE_UNCLEAR_THRESHOLD=0.5
PHASE_MIN_GAP=0.1
# Устойчивость фазы: доля последних тиков с той же фазой (0..1). Размер истории по ТФ (число тиков).
PHASE_STABILITY_MIN=0.6
PHASE_HISTORY_SIZE=5

# Тренд (модуль market_trend): минимальная сила (0..1), порог неясности, минимальный разрыв
TREND_STRENGTH_MIN=0.35
TREND_UNCLEAR_THRESHOLD=0.3
TREND_MIN_GAP=0.08
# В боковике (ADX < 20) чаще возвращать flat; мин. разрыв для «вниз» (0.10 = строже)
TREND_FLAT_WHEN_RANGE=1
TREND_MIN_GAP_DOWN=0
# Адаптация по ТФ (short/long): 1 = lookback, min_gap, min_gap_down по профилю; 0 = только из .env
TREND_USE_PROFILES=1
# Учёт режима рынка: 1 = в trend выше вес структуры/EMA, в range ниже; 0 = без учёта
TREND_REGIME_WEIGHTING=1
# В режиме surge: множитель bull/bear. 0 = выкл; 0.88 = чаще flat
TREND_SURGE_PENALTY=0
# Для «вверх» требовать подтверждение от +DI/-DI или структуры. 0 = нет (больше зон вверх на графике)
TREND_CONFIRM_UP=0
# Низкий объём: при volume_ratio < порога — множитель bull/bear. 0 = выкл
TREND_LOW_VOLUME_THRESHOLD=0.7
TREND_LOW_VOLUME_PENALTY=0
# Минимум согласований из трёх (структура, EMA, +DI/-DI) для up/down. 0 = не проверять (баланс зон как на графике)
TREND_MIN_AGREEMENT=0

# Торговые зоны: макс. уровней в выдаче. 0 = все найденные зоны, >0 = топ N по силе
TRADING_ZONES_MAX_LEVELS=0

# Фильтры входа: 0 = отключено. VOLUME_MIN_RATIO — мин. объём относительно MA(20). ATR_MAX_RATIO — макс. ATR/MA(ATR).
VOLUME_MIN_RATIO=0
ATR_MAX_RATIO=0
# Минимум ТФ, совпадающих по тренду и фазе с направлением входа (1 = только старший, 2+ = консенсус)
TF_ALIGN_MIN=1
# Устойчивость тренда: доля последних тиков с тем же направлением (0 = не проверять)
TREND_STABILITY_MIN=0
# Уровни: вход только если цена в пределах N (доля, 0.02 = 2%) от свинг-уровня. 0 = не проверять
LEVEL_MAX_DISTANCE_PCT=0
# Режим рынка (тренд/диапазон/всплеск): 1 = не входить при режиме «всплеск» по старшему ТФ
REGIME_BLOCK_SURGE=1
# Единый score входа (0..1): веса фазы, тренда и совпадения ТФ (сумма любая — нормализуется)
ENTRY_SCORE_WEIGHT_PHASE=0.4
ENTRY_SCORE_WEIGHT_TREND=0.35
ENTRY_SCORE_WEIGHT_TF_ALIGN=0.25
# Качество свечей: мин. quality_score (0..1) для использования ТФ; 0 = не проверять
CANDLE_QUALITY_MIN_SCORE=0

# Источник свечей для анализа: db — из БД (меньше запросов), exchange — каждый тик с биржи
DATA_SOURCE=db
# Минимальная уверенность сигнала (0..1) для фильтра «торговый» сигнал; 0 — не фильтровать
SIGNAL_MIN_CONFIDENCE=0
# Ретраи запросов к Bybit: макс попыток, задержка (с) при rate limit / сбое
EXCHANGE_MAX_RETRIES=5
EXCHANGE_RETRY_BACKOFF_SEC=1
EXCHANGE_REQUEST_TIMEOUT_SEC=30

# --- База для обучения (накопление свечей) ---
# Путь к SQLite (каталог создаётся сам)
DB_PATH=data/klines.db
# Все таймфреймы для БД: 1,3,5,15,30,60,120,240,360,720,D,W,M
TIMEFRAMES_DB=1,3,5,15,30,60,120,240,360,720,D,W,M
# Сколько свечей вглубь загружать при первом бэкфилле на каждый ТФ
BACKFILL_MAX_CANDLES=50000
# Как часто дотягивать новые свечи (секунды)
DB_UPDATE_INTERVAL_SEC=60
# При старте бота автоматически углублять историю по всем ТФ до упора (1=да, 0=нет)
AUTO_EXTEND_AT_STARTUP=1

# --- Логирование ---
# Каталог логов (пусто = проект/logs). bot.log — всё, signals.log — компактные строки по каждому сигналу
LOG_DIR=
# Уровень: DEBUG, INFO, WARNING, ERROR. LOG_LEVEL_FILE — для файла (по умолчанию как LOG_LEVEL)
LOG_LEVEL=INFO
# Макс. размер одного файла (МБ), число старых файлов при ротации
LOG_FILE_MAX_MB=10
LOG_BACKUP_COUNT=7
# Писать ли отдельно signals.log (1/0)
LOG_SIGNALS_FILE=1

# --- Telegram (управление ботом) ---
# Токен от @BotFather
TELEGRAM_BOT_TOKEN=
# Разрешённые user id через запятую (пусто = все). Узнать id: /id в боте
TELEGRAM_ALLOWED_IDS=
# Алерт при смене сигнала: чат id для уведомлений (пусто = выкл), 1 = включить проверку
TELEGRAM_ALERT_CHAT_ID=
TELEGRAM_ALERT_ON_SIGNAL_CHANGE=0
# Интервал проверки (сек), мин. уверенность для алерта (0 = любая)
TELEGRAM_ALERT_INTERVAL_SEC=90
TELEGRAM_ALERT_MIN_CONFIDENCE=0
