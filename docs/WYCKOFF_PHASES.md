# Фазы и подфазы Вайкоффа — для понимания

В системе используются **6 фаз** (основной цикл). Подфазы Вайкоффа в вывод не входят — они используются как **признаки** при расчёте score по фазам.

---

## 1. Фазы (что выдаёт система)

Это то, что возвращает `detect_phase()` — одна из шести фаз.

| Фаза (код)     | Русское название | Смысл |
|----------------|------------------|--------|
| **accumulation**  | Накопление       | Боковик у низа, низкая волатильность, «накопление» перед ростом |
| **markup**        | Рост             | Восходящий тренд |
| **distribution**  | Распределение    | Боковик у верха, разворот вниз, «раздача» перед падением |
| **markdown**      | Падение          | Нисходящий тренд |
| **capitulation** | Капитуляция      | Резкое падение и/или всплеск объёма (часто зона дна, ожидаем отскок) |
| **recovery**      | Восстановление   | Отскок от дна, стабилизация после капитуляции |

**Интерпретация для стратегий:**
- Бычьи фазы (ожидание роста): `markup`, `recovery`, `capitulation`
- Медвежьи (ожидание падения): `markdown`, `distribution`
- Нейтральная: `accumulation`

---

## 2. Подфазы Вайкоффа (теория)

В классической схеме Вайкоффа внутри фаз **Accumulation** и **Distribution** выделяют подфазы — этапы внутри бокового диапазона. В нашем коде эти понятия **не выводятся** как отдельные состояния, но часть из них используется как **признаки** при расчёте score (например, Spring, Upthrust, Selling/Buying climax).

### 2.1. Подфазы фазы накопления (Accumulation)

Происходят у низа, в боковике перед ростом:

| Подфаза | Обозначение | Описание |
|---------|-------------|----------|
| Предварительная поддержка | **PS** (Preliminary Support) | Первое заметное давление покупателей после падения |
| Капитуляция продавцов | **SC** (Selling Climax) | Резкое падение + всплеск объёма, паника, часто дно |
| Автоматический откат | **AR** (Automatic Rally) | Отскок вверх от зоны SC |
| Вторичная проверка | **ST** (Secondary Test) | Возврат к зоне низа, проверка — держится ли низ |
| Spring | **Spring** | Ложный пробой низа: цена ушла ниже диапазона и вернулась внутрь (сигнал завершения накопления) |

После Spring часто начинается **Markup**.

### 2.2. Подфазы фазы распределения (Distribution)

Происходят у верха, в боковике перед падением:

| Подфаза | Обозначение | Описание |
|---------|-------------|----------|
| Предварительное предложение | **PSY** (Preliminary Supply) | Первое давление продавцов после роста |
| Истощение покупателей | **BC** (Buying Climax) | Резкий рост + всплеск объёма, эйфория, часто вершина |
| Автоматическая реакция | **AR** (Automatic Reaction) | Откат вниз от зоны BC |
| Вторичная проверка | **ST** (Secondary Test) | Возврат к зоне верха, проверка — держится ли верх |
| Upthrust | **Upthrust** | Ложный пробой верха: цена ушла выше диапазона и вернулась внутрь (сигнал завершения распределения) |

После Upthrust часто начинается **Markdown**.

---

## 3. Что из подфаз используется в коде

В `market_phases.py` как **признаки** (входы в расчёт score), без вывода подфаз:

| Элемент | Функция в коде | Назначение |
|---------|----------------|------------|
| **Spring** | `_spring_upthrust()` → spring | Ложный пробой низа диапазона, закрытие вернулось внутрь |
| **Upthrust** | `_spring_upthrust()` → upthrust | Ложный пробой верха диапазона, закрытие вернулось внутрь |
| **Spring/Upthrust + объём** | `_spring_upthrust_volume_confirmed()` | То же + подтверждение объёмом в хвосте |
| **Selling Climax** | `_climax()` → selling_climax | Резкое падение (return) + всплеск объёма |
| **Buying Climax** | `_climax()` → buying_climax | Резкий рост + всплеск объёма |

Структура (HH/HL, LH/LL), позиция цены в диапазоне, объём у границ, «свежесть» зоны — тоже признаки Вайкоффа, они участвуют в расчёте score по каждой из **6 фаз**. Итоговый вывод — всегда одна фаза из списка в разделе 1.

---

## 4. Сводка

- **Фазы** — 6 состояний: accumulation, markup, distribution, markdown, capitulation, recovery. Это то, что видит стратегия и пользователь.
- **Подфазы** — PS, SC, AR, ST, Spring, Upthrust, BC и т.д. — в системе **не выводятся**. Spring, Upthrust и climax’ы используются только как признаки для определения одной из шести фаз.
